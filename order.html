<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Place Your Order</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-lg mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-xl font-bold mb-4">Place Your Order</h2>

        <div class="mb-4">
            <label class="block text-sm font-semibold">Phone Number:</label>
            <input type="text" id="customerPhone" class="w-full p-2 border rounded" placeholder="Enter phone number">
        </div>

        <div id="customerDetails" class="hidden mb-4">
            <label class="block text-sm font-semibold">Name:</label>
            <input type="text" id="customerName" class="w-full p-2 border rounded">
            
            <label class="block text-sm font-semibold mt-2">Address:</label>
            <input type="text" id="customerAddress" class="w-full p-2 border rounded">
        </div>

        <h3 class="text-lg font-semibold mt-4">Select Vegetables</h3>
        <p class="text-sm text-gray-600 mb-2">Maximum 14 vegetables allowed.</p>
        <div id="vegetableList" class="grid grid-cols-3 gap-4 mb-4"></div>

        <p class="font-semibold">Total Selected: <span id="totalCount">0</span>/14</p>
        <button onclick="submitOrder()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded" id="submitButton" disabled>Submit Order</button>
    </div>

    <script>
        const orderFormURL = "https://docs.google.com/forms/d/e/1FAIpQLSfmu4toOaZbFPzQbCDn5dJfVAJrp9ggMz5ChPnlMdDeJALpFA/formResponse";

        // Assume these entry IDs (replace them with actual ones from Google Form)
        const entryOrderNumber = "entry.1234567890";  // Order Number
        const entryOrderDateTime = "entry.9876543210"; // Order Date Time
        const entryItemsSelected = "entry.5678901234"; // Items Selected
        const entryCustomerPhone = "entry.1357924680"; // Customer Phone Number

        let vegetables = [
            { name: "Tomato", imageUrl: "https://via.placeholder.com/100" },
            { name: "Potato", imageUrl: "https://via.placeholder.com/100" },
            { name: "Carrot", imageUrl: "https://via.placeholder.com/100" },
            { name: "Onion", imageUrl: "https://via.placeholder.com/100" }
        ];
        let selectedVeggies = [];

        function renderVegetables() {
            let vegList = document.getElementById("vegetableList");
            vegList.innerHTML = "";
            vegetables.forEach((veg, index) => {
                vegList.innerHTML += `
                    <div class='p-2 bg-gray-200 rounded text-center'>
                        <img src='${veg.imageUrl}' class='w-full h-24 object-cover rounded mb-2'>
                        <p class='text-sm font-semibold'>${veg.name}</p>
                        <input type='checkbox' onchange='toggleVegetable("${veg.name}")'>
                    </div>`;
            });
        }

        function toggleVegetable(vegName) {
            if (selectedVeggies.includes(vegName)) {
                selectedVeggies = selectedVeggies.filter(v => v !== vegName);
            } else if (selectedVeggies.length < 14) {
                selectedVeggies.push(vegName);
            }
            document.getElementById("totalCount").innerText = selectedVeggies.length;
            document.getElementById("submitButton").disabled = selectedVeggies.length === 0;
        }

        function generateOrderNumber() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function submitOrder() {
            let phone = document.getElementById("customerPhone").value;
            if (!phone || selectedVeggies.length === 0) {
                alert("Please enter phone number and select at least one vegetable.");
                return;
            }

            let orderNumber = generateOrderNumber();
            let orderDateTime = new Date().toLocaleString();
            let itemsSelected = selectedVeggies.join(", ");

            let formData = new FormData();
            formData.append(entryOrderNumber, orderNumber);
            formData.append(entryOrderDateTime, orderDateTime);
            formData.append(entryItemsSelected, itemsSelected);
            formData.append(entryCustomerPhone, phone);

            fetch(orderFormURL, {
                method: "POST",
                body: formData
            }).then(response => {
                alert("Order Submitted Successfully!");
                window.location.href = "confirmation.html"; // Redirect to confirmation page
            }).catch(error => {
                console.error("Error:", error);
                alert("Failed to submit order. Try again.");
            });
        }

        renderVegetables();
    </script>
</body>
</html>
